# redis 用途

redis 是一个 key-value 的内存数据库

1. 缓存
2. 分布式锁
3. 消息队列

# redis 数据结构

1. string
2. hash
3. list
4. set
5. zset

# redis 主从同步

## 主从同步的流程

首先全量同步，然后增量同步。全量同步时，首先 fork 出一个子进程，并生成 .rdb 文件，然后将其发送到从节点，从节点应用此 .rdb 文件来初始化数据。然后就进入增量同步状态，redis 主节点将命令备份，并将其发送到从节点执行。

## 主从同步时怎么应付网络抖动

redis 会使用一个数据复制缓区来处理这种情形

# redis 集群

## hash tag

# 用途

## 用 redis 充当缓存

1. key 的过期机制：定时扫描或者在获取 key 的时候检查 key 的时间戳，折中的策略是抽取 + 即时检查。
2. 缓存击穿：redis 集群中不存在，从而导致大量的访问请求直接压向数据库。
3. 缓存雪崩：设置随机的过期时间来避免大量的数据同时过期。
4. 淘汰机制：LRU
5. 缓存一致性：先更新数据库，再删除缓存。

## redis 实现分布式锁

- 获得锁：使用脚本来实现一个 `tryLock` 功能，执行脚本时，通过比较 key 的时间戳，来判断是否能获得锁。如果这个 key 不存在，或 key 的时间戳超时，那么就可以获得锁，并更新 key 的时间戳。
- 释放锁：直接删除 key 即可。

## redis 实现消息队列

用 list 可以实现轻量级消息队列。
